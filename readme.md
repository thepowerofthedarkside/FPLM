Техническое задание (ТЗ) на прототип системы хранения информации о продукте (PIM/упрощённый PLM)
1.	Назначение и цель
Система предназначена для централизованного хранения и управления информацией о продуктах (изделиях): карточки изделий, их атрибуты, значения атрибутов и справочники (каталоги) значений. Цель прототипа — дать минимально достаточный интерфейс для ввода, редактирования, поиска и контроля целостности данных.
2.	Область применения и границы прототипа (MVP)
Входит в MVP:
•	Сущности: Изделия, Атрибуты, Справочники (каталоги значений), Значения атрибутов изделия.
•	CRUD для изделий, атрибутов, справочников и элементов справочников.
•	Привязка атрибутов к изделиям и хранение значений.
•	Поиск и фильтрация изделий.
•	Базовые роли и разграничение доступа.
•	Минимальный веб-интерфейс.
Не входит в MVP (можно запланировать как “после прототипа”):
•	Версионирование, согласование/workflow, аудит изменений (кроме простого “кто/когда”).
•	Импорт/экспорт (Excel/CSV), интеграции, API для внешних систем (кроме внутреннего REST для UI).
•	Сложные иерархии изделий (BOM), варианты/конфигурации, мультиязычность.
•	Управление медиа-файлами (изображения, документы).
3.	Термины
•	Изделие: продукт/позиция, для которой хранятся атрибуты (например, модель, артикул).
•	Атрибут: характеристика изделия (например, “цвет”, “материал”, “размер”).
•	Справочник: набор допустимых значений для атрибутов типа “выбор из списка”.
•	Значение атрибута: конкретное значение атрибута для изделия.
4.	Роли пользователей и права
•	Администратор:
o	Полный доступ ко всем сущностям.
o	Управление пользователями/ролями (минимально: создание, назначение роли, блокировка).
•	Контент-менеджер:
o	CRUD изделий.
o	Назначение атрибутов изделию и заполнение значений.
o	Просмотр справочников, использование значений.
•	Справочник-менеджер:
o	CRUD справочников и элементов справочников.
o	CRUD атрибутов (включая привязку атрибутов к справочникам).
•	Просмотр (read-only):
o	Просмотр и поиск изделий, просмотр карточек.
5.	Функциональные требования
5.1. Управление изделиями
•	Создание изделия:
o	Обязательные поля: Наименование, Код/Артикул (уникальный), Статус (черновик/активен/архив).
o	Дополнительные: Краткое описание, Категория (из справочника), Дата создания, Автор.
•	Редактирование изделия.
•	Архивация изделия (без физического удаления).
•	Просмотр карточки изделия:
o	Блок “Основные данные”.
o	Блок “Атрибуты” (таблица атрибутов и значений).
•	Список изделий:
o	Поиск по наименованию и артикулу.
o	Фильтры: статус, категория.
o	Сортировка: по дате/названию.
5.2. Управление атрибутами
•	Создание атрибута:
o	Обязательные поля: Код (уникальный), Наименование, Тип данных.
o	Типы данных MVP: строка, число, дата, логический, справочник (enum).
o	Признаки: обязательный/необязательный, множественный/одиночный.
o	Для типа “справочник”: ссылка на конкретный справочник.
•	Редактирование атрибута (с ограничениями целостности, см. ниже).
•	Деактивация атрибута (используемый атрибут нельзя удалить физически).
•	Список атрибутов: поиск по коду/названию, фильтр по типу.
5.3. Управление справочниками
•	Создание справочника:
o	Обязательные поля: Код (уникальный), Наименование, Описание (опц.).
•	Элементы справочника:
o	CRUD элементов: Код/значение (уникально внутри справочника), Наименование/Отображаемое значение, Признак активности.
o	Возможность сортировки элементов (порядок отображения).
•	Просмотр использования справочника:
o	Где применяется (какими атрибутами).
5.4. Назначение атрибутов изделию и заполнение значений
•	Для каждого изделия должна быть возможность:
o	Добавить атрибуты из общего списка (выбор).
o	Указать значение по каждому атрибуту согласно типу данных:
	строка: текст
	число: числовое поле
	дата: календарь
	логический: чекбокс
	справочник: выпадающий список (одиночный или множественный)
•	Валидация:
o	Обязательные атрибуты не могут быть пустыми для статуса “активен”.
o	Типовые ошибки: неверный формат числа/даты, значение не из справочника.
•	Кнопка “Проверить полноту” (валидатор карточки изделия).
5.5. Пользователи и доступ
•	Авторизация: логин/пароль (для прототипа допустимо простое решение).
•	Управление пользователями (MVP-минимум):
o	список пользователей, создание, назначение роли, блокировка.
•	Разграничение:
o	read-only не видит кнопок редактирования.
o	контент-менеджер не редактирует справочники и атрибуты (если не имеет соответствующей роли).
6.	Нефункциональные требования
•	Интерфейс: веб-приложение, русскоязычный UI.
•	Производительность MVP:
o	10 000 изделий, 300 атрибутов, 50 справочников по 1 000 элементов (оценочно).
o	Открытие списка изделий до 2 сек при 50 записях на странице.
•	Надёжность:
o	Резервное копирование БД (ручное/скриптом).
•	Безопасность:
o	Хранение паролей только в хэшированном виде.
o	Ролевой доступ на уровне backend.
•	Логирование:
o	Системные ошибки и действия входа/выхода.
o	Желательно: кто изменил изделие (updated_by, updated_at).
7.	Модель данных (описательно)
Сущности:
•	users: id, login, password_hash, role, is_active, created_at
•	products (изделия): id, sku(уникальный), name, description, status, category_id, created_at, created_by, updated_at, updated_by
•	attributes: id, code(уникальный), name, data_type, is_required, is_multivalue, dictionary_id (nullable), is_active
•	dictionaries: id, code(уникальный), name, description
•	dictionary_items: id, dictionary_id, code/value, label, sort_order, is_active
•	product_attributes (связь изделие–атрибут): id, product_id, attribute_id
•	product_attribute_values:
o	id, product_id, attribute_id,
o	value_string / value_number / value_date / value_bool / dictionary_item_id (в зависимости от типа),
o	Для множественных: несколько строк на один attribute_id.
Ограничения целостности:
•	Нельзя удалить справочник, если он привязан к атрибуту.
•	Нельзя изменить тип атрибута, если по нему уже есть значения (разрешить только при отсутствии значений).
•	Уникальность sku у изделий.
•	Уникальность code у атрибутов и справочников.
8.	Требования к минимальному интерфейсу (экраны)
1.	Логин.
2.	Главный экран (меню):
o	Изделия
o	Атрибуты
o	Справочники
o	Пользователи (только админ)
3.	Изделия:
o	список + поиск/фильтры + кнопка “Создать”
o	карточка изделия (вкладки/блоки: Основное, Атрибуты)
4.	Атрибуты:
o	список + создание/редактирование
5.	Справочники:
o	список справочников
o	карточка справочника + таблица элементов
6.	Пользователи:
o	список + создание/редактирование роли/блокировка
UX-минимум:
•	Единый стиль таблиц: пагинация, сортировка, поиск.
•	Подтверждение опасных действий (архивирование, деактивация).
•	Сообщения об ошибках валидации рядом с полями.
9.	Архитектура (логическая)
•	Frontend: SPA или серверные шаблоны (достаточно минимально).
•	Backend: REST API (или серверный MVC), модуль авторизации, модуль управления сущностями.
•	База данных: реляционная (PostgreSQL/MySQL/SQLite для прототипа).
•	Слой бизнес-валидации: проверка типов, обязательности, ссылочной целостности.
10.	Критерии приёмки прототипа
•	Можно создать справочник, добавить элементы, использовать справочник в атрибуте типа “список”.
•	Можно создать атрибуты разных типов, включая обязательный и множественный.
•	Можно создать изделие, назначить ему атрибуты и заполнить значения, включая выбор из справочника.
•	Поиск изделия по наименованию и артикулу работает.
•	Роли ограничивают доступ (read-only не может изменять данные; контент-менеджер не управляет справочниками).
•	Валидация “активного” изделия: обязательные атрибуты должны быть заполнены.
11.	Этапы разработки (рекомендуемая структура работ)
1.	Проектирование:
o	ER-модель, правила целостности, прототип экранов.
2.	Реализация базы и backend:
o	CRUD для справочников/атрибутов/изделий, авторизация, роли.
3.	Реализация UI:
o	списки, формы, карточка изделия с атрибутами.
4.	Валидации и ограничения:
o	обязательность, запреты на изменение типа, деактивации.
5.	Тестирование:
o	чек-лист по критериям приёмки, тестовые данные.
6.	Пакетирование и развёртывание прототипа:
o	инструкция запуска, конфиг, демо-учётки.


## 12. Статус реализации прототипа и запуск
Реализован рабочий MVP-сервис по данному ТЗ на `FastAPI + SQLite + Jinja2`.

### 12.1. Что уже работает
- Авторизация (`login/password`) и роли:
- `admin`
- `content-manager`
- `dictionary-manager`
- `read-only`
- CRUD:
- Изделия (`products`) с поиском, фильтрацией, сортировкой, архивированием.
- Атрибуты (`attributes`) с типами `string/number/date/bool/enum`, признаками обязательности и множественности.
- Справочники (`dictionaries`) и элементы справочников (`dictionary_items`).
- Пользователи (`users`) для роли `admin` (создание, смена роли, блокировка).
- Назначение атрибутов изделию и заполнение значений с валидацией типов.
- Проверка полноты изделия по обязательным атрибутам.
- Ограничения целостности:
- запрет удаления справочника, если он используется атрибутами;
- запрет смены типа атрибута при наличии значений;
- уникальность `sku`, кодов атрибутов и справочников.

### 12.2. Быстрый запуск (Windows / PowerShell)
1. Активировать venv:
```powershell
.\.venv\Scripts\Activate.ps1
```
2. Установить зависимости:
```powershell
pip install -r requirements.txt
```
3. Запустить приложение:
```powershell
uvicorn app.main:app --reload
```
4. Открыть:
- `http://127.0.0.1:8000`

### 12.3. Демо-учетки
- `admin / admin`
- `content / content`
- `dict / dict`
- `viewer / viewer`

## 13. Fashion PLM (женская верхняя одежда)
Добавлены специализированные сущности и интерфейс:
- `collections` (коллекции: сезон/год/линия бренда)
- `suppliers` (поставщики)
- `product_specs` (fashion-спецификация изделия)

Новые экраны:
- `/collections`
- `/suppliers`
- блок `Fashion-спецификация` в карточке изделия `/products/{id}`

### Заполнение БД примерами
Для генерации демонстрационных данных (по 10 записей в ключевых таблицах):
```powershell
.\.venv\Scripts\python.exe seed_demo.py
```

После выполнения будут заполнены таблицы:
- `users` = 10
- `dictionaries` = 10
- `dictionary_items` = 100 (по 10 элементов на каждый из 10 справочников)
- `attributes` = 10
- `products` = 10
- `collections` = 10
- `suppliers` = 10
- `product_attributes` = 10
- `product_attribute_values` = 10
- `product_specs` = 10

## 14. Вложения в карточке изделия
Добавлена возможность прикреплять файлы к карточке изделия (`/products/{id}`):
- `sketch` (Скетч)
- `technical_spec` (Техническое задание)
- `patterns` (Лекала)
- `sample_photo` (Фото образца)
- `materials` (Материалы)

Поддерживаемые расширения: `pdf, doc, docx, xls, xlsx, csv, txt, zip, rar, jpg, jpeg, png, webp, svg, dxf, plt`.

Файлы хранятся в `app/static/product_files/`.

## 15. Очереди и канбан задач
Добавлен модуль задач:
- Очереди: `/queues`
- Доски: `/boards`
- Канбан доски: `/boards/{id}/kanban`
- Задачи: `/tasks`

Поддержка полей задачи:
- статус, приоритет, теги
- дата начала, конца, дедлайн
- автор, исполнитель
- комментарий, название
- принадлежность к очереди и доске
- привязка к коллекции и изделию
- вложенные файлы задачи

Файлы задач хранятся в `app/static/task_files/`.

### 15.1. Канбан Drag-and-Drop
На странице `/boards/{id}/kanban` добавлено перетаскивание карточек задач между колонками статусов.

В карточке канбана отображаются:
- автор
- исполнитель
- дедлайн
- важность
- коллекция
- изделие

## 16. Системные настройки и QR
Добавлена страница `/settings` (только admin):
- базовый адрес сервера (`server_base_url`) для генерации QR
- переключатели отображения разделов меню: Атрибуты, Справочники, Пользователи

Автоматическая генерация QR:
- `/qr/product/{id}.png` — ссылка на карточку изделия
- `/qr/collection/{id}.png` — ссылка на карточку коллекции

QR-коды отображаются в карточке изделия и в карточке коллекции.

## 17. Фильтры задач в очереди и канбане
Добавлено:
- быстрый поиск по атрибутам задач (по названию, комментарию, тегам, статусу/приоритету, исполнителю, коллекции, изделию)
- popup-фильтр по атрибутам в:
  - `/queues/{id}`
  - `/boards/{id}/kanban`

## 18. Ограничение кнопок
Для всех кнопок установлен `max-width: 200px`.
